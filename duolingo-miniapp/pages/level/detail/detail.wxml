<!-- Level Detail - åŸºäºéŸ³é¢‘å’Œå›¾ç‰‡çš„ç­”é¢˜é¡µé¢ -->
<view class="page">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="top-bar">
    <text class="back-btn" bindtap="handleBack">â†</text>
    <text class="progress-text" wx:if="{{levelId === 1 || levelId === '1'}}">
      Level 1 Â· {{level1QuestionIndex + 1}}/{{level1QuestionTotalDisplay}}
    </text>
    <text class="progress-text" wx:else>Level {{levelId}}</text>
    <view class="spacer"></view>
  </view>

  <!-- ä¸»å®¹å™¨ -->
  <scroll-view class="content" scroll-y="true">
    <!-- Level 1 - åŸºäºéŸ³é¢‘å’Œå›¾ç‰‡ -->
    <block wx:if="{{levelId === 1 || levelId === '1'}}">
      <view class="l1-wrap">
        <text class="l1-title">æ ¹æ®éŸ³é¢‘ï¼Œç»“åˆå›¾ç‰‡è¿›è¡Œå›ç­”</text>
        <text class="l1-subtitle">{{level1PromptText}}</text>

        <view class="l1-image-wrap">
          <image class="l1-image" src="{{level1ImageUrl}}" mode="aspectFill"></image>
        </view>

        <view class="l1-card">
          <text class="l1-question-title">{{level1QuestionTitle}}</text>
          <view class="l1-audio-row">
            <button class="l1-btn l1-btn-primary small" bindtap="toggleLevel1PromptAudio">
              {{level1IsPlayingPrompt ? 'æš‚åœé¢˜ç›®' : 'æ’­æ”¾é¢˜ç›®'}}
            </button>
            <view class="l1-progress-track">
              <view class="l1-progress-fill" style="width: {{level1PromptProgress}}%;"></view>
            </view>
          </view>
          <text class="l1-time">{{level1PromptCurrentText}} / {{level1PromptDurationText}}</text>
          <text class="l1-attempt">å°è¯•æ¬¡æ•°ï¼š{{level1AttemptsUsed}} / {{level1MaxAttempts}}</text>
          <text class="l1-pass">é€šå…³åˆ†ï¼š{{level1PassScore}}</text>
        </view>

        <view class="l1-card">
          <text class="l1-record-status">
            {{level1IsRecording ? 'å½•éŸ³ä¸­...' : (level1HasRecording ? 'å½•éŸ³å®Œæˆï¼Œå¯æäº¤è¯„åˆ†' : 'ç‚¹å‡»å¼€å§‹å½•éŸ³')}}
          </text>
          <text class="l1-record-time" wx:if="{{level1IsRecording || level1HasRecording}}">
            æ—¶é•¿ï¼š{{level1RecordSeconds}}s
          </text>
          <view class="l1-action-row">
            <button
              class="l1-btn l1-btn-primary"
              bindtap="toggleLevel1Recording"
              loading="{{level1Submitting}}"
              disabled="{{level1Submitting}}"
            >
              {{level1IsRecording ? 'åœæ­¢å½•éŸ³' : 'å¼€å§‹å½•éŸ³'}}
            </button>
          </view>
          <view class="l1-action-row" wx:if="{{level1HasRecording && !level1IsRecording}}">
            <button
              class="l1-btn"
              bindtap="handleLevel1Rerecord"
              disabled="{{level1Submitting || (!level1PassAchieved && level1AttemptsUsed >= level1MaxAttempts)}}"
            >
              é‡æ–°å½•åˆ¶
            </button>
            <button
              class="l1-btn l1-btn-primary"
              bindtap="handleLevel1Submit"
              loading="{{level1Submitting}}"
              disabled="{{level1Submitting || level1AttemptsUsed >= level1MaxAttempts}}"
            >
              æäº¤è¯„åˆ†
            </button>
          </view>
        </view>

        <view class="l1-result-card" wx:if="{{level1Result}}">
          <text class="l1-grade {{'grade-' + level1Result.gradeKey}}">{{level1Result.gradeLabel}}</text>
          <text class="l1-score">å¾—åˆ†ï¼š{{level1Result.score}}</text>
          <text class="l1-result-msg">{{level1Result.message}}</text>
        </view>

        <view class="l1-answer-card" wx:if="{{!level1PassAchieved && level1AttemptsUsed >= level1MaxAttempts}}">
          <text class="l1-answer-title">å·²è¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°</text>
          <text class="l1-answer-desc">å…ˆå¬è€å¸ˆç­”æ¡ˆå¹¶è·Ÿè¯»ï¼Œå†è¿›å…¥ä¸‹ä¸€é¢˜</text>
          <button class="l1-btn" bindtap="toggleLevel1AnswerAudio">
            {{level1IsPlayingAnswer ? 'æš‚åœç­”æ¡ˆéŸ³é¢‘' : 'æ’­æ”¾ç­”æ¡ˆéŸ³é¢‘'}}
          </button>
        </view>

        <view class="l1-next-wrap" wx:if="{{level1CanGoNext}}">
          <button
            class="l1-btn l1-btn-primary"
            bindtap="goLevel1Next"
            disabled="{{!level1PassAchieved && !level1AnswerPlayed}}"
          >
            {{level1QuestionIndex + 1 >= level1QuestionTotal ? 'å®Œæˆæœ¬å…³' : 'ä¸‹ä¸€é¢˜'}}
          </button>
          <text class="l1-next-tip" wx:if="{{!level1PassAchieved && !level1AnswerPlayed}}">
            è¯·å…ˆæ’­æ”¾ç­”æ¡ˆéŸ³é¢‘å¹¶è·Ÿè¯»
          </text>
        </view>
      </view>
    </block>

    <!-- Level 2 - è§†é¢‘ + åˆ†å¥å¡ç‰‡ -->
    <block wx:if="{{levelId === 2 || levelId === '2'}}">
      <!-- æ•™å¸ˆè§†é¢‘ -->
      <view class="video-container">
        <image class="video-image" src="{{videoImageUrl}}" mode="aspectFill"></image>
        <view class="video-overlay">
          <text class="play-icon-large">â–¶</text>
          <view class="video-controls">
            <text class="video-time">{{videoCurrentTime}}</text>
            <view class="video-progress">
              <view class="progress-bg"></view>
              <view class="progress-fill" style="width: {{videoProgress}}%"></view>
              <view class="progress-dot" style="left: {{videoProgress}}%"></view>
            </view>
            <text class="video-duration">{{videoDuration}}</text>
          </view>
        </view>
      </view>

      <!-- åˆ†å¥å¡ç‰‡åˆ—è¡¨ -->
      <view class="sentence-pills">
        <view class="pill">
          <text class="pill-text">{{currentSentenceIndex}}/{{totalSentences}}</text>
        </view>
      </view>

      <!-- åˆ†å¥å¡ç‰‡ -->
      <view class="sentence-cards">
        <view
          wx:for="{{sentenceCards}}"
          wx:key="id"
          class="sentence-card {{item.isActive ? 'active' : ''}}"
          bindtap="selectSentence"
          data-index="{{index}}"
        >
          <text class="card-title">{{item.enText}}</text>
          <text class="card-subtitle">{{item.zhText}}</text>

          <view class="card-bottom">
            <view class="speed-button">
              <text class="speed-icon">ğŸ¢</text>
              <text class="speed-text">{{item.speed}}</text>
            </view>
            <view class="progress-bar-small">
              <view class="progress-bg-small"></view>
              <view class="progress-fill-small" style="width: {{item.progress}}%"></view>
            </view>
            <text class="duration-text">{{item.duration}}</text>
            <view class="mic-btn {{item.isAnswered ? 'answered' : ''}}" bindtap="recordSentence" data-index="{{index}}">
              <text class="mic-icon">ğŸ¤</text>
            </view>
          </view>
        </view>
      </view>
    </block>

    <!-- Level 3 - å­¦ç”Ÿå¤è¿°æ¨¡å¼ -->
    <block wx:if="{{levelId === 3 || levelId === '3'}}">
      <!-- é¡¶éƒ¨æç¤ºå¡ç‰‡ -->
      <view class="level3-instruction-card">
        <text class="level3-instruction-text">{{level3PromptText}}</text>
      </view>

      <!-- ä¸­é—´ç©ºç™½åŒºåŸŸ + å½•éŸ³éƒ¨åˆ† -->
      <view class="level3-recording-area">
        <!-- å½•éŸ³æç¤ºæ ‡ç­¾ -->
        <text class="level3-recording-hint">{{level3RecordLabel}}</text>

        <!-- å½•éŸ³æŒ‰é’® -->
        <view class="level3-button-wrapper">
          <view class="level3-record-btn {{isRecording ? 'recording' : ''}}" bindtap="toggleRecording">
            <text class="level3-record-icon">ğŸ¤</text>
          </view>
          <text class="level3-button-label">{{recordButtonLabel}}</text>
        </view>
      </view>

      <!-- åº•éƒ¨æç¤ºå¡ç‰‡ -->
      <view class="level3-note-card">
        <text class="level3-note-title">æç¤º</text>
        <text class="level3-note-text">{{level3NoteText}}</text>
      </view>
    </block>
  </scroll-view>
</view>
